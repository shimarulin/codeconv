---
title: Node.js
description: Рекомендации по работе с Node.js
category: Соглашения
---

В новых версиях Node.js, как и в большинстве программных продуктов, происходит добавление новых возможностей, а иногда и
удаление устаревшего поведения. Поэтому разрабатываемый код может не запускаться под значительно более старыми или
новыми версиями Node.js. Все это приводит к необходимости указания используемых в проекте версий Node.js.

В файле `package.json` в поле `engines` можно указать диапазон версий Node.js, с которой будет работать пакет, либо даже
конкретную версию (см. https://docs.npmjs.com/cli/v6/configuring-npm/package-json#engines). Это поле предназначено в
первую очередь для потребителя кода, и, в случае, если текущая версия Node.js не соответствует указанному в поле
`engines` диапазону, пакет не будет установлен. Попытка установить зависимости проекта на локальной машине с
установленной Node.js, версия которой находится вне указанного диапазона, также окончится неудачей.

Окружение Node.js может быть установлено в системе различными способами. К тому же, на различных машинах версия
установленной Node.js может отличаться. Как правило, приходится работать с разными версиями, поэтому предпочтительным
путем является установка Node.js с помощью [NVM](https://github.com/nvm-sh/nvm) (Linux, MacOS), либо запуск внутри
контейнера с предустановленной Node.js определенной версии с помощью [Docker](https://www.docker.com/),
[Podman](https://podman.io/), либо любого другого инструмента для управления контейнерами.

Для небольших проектов использование контейнеров выглядит избыточным, гораздо проще использовать
[NVM](https://github.com/nvm-sh/nvm). Помимо прочих возможностей по управлению версиями Node.js, данный инструмент также
позволяет указать используемую версию окружения для определенного каталога с помощью файла
[`.nvmrc`](https://github.com/nvm-sh/nvm#nvmrc). Команда `nvm use` без аргументов прочтет этот файл и задействует
указанную в нем версию. Кроме того, возможно настроить
[интеграцию с командной оболочкой](https://github.com/nvm-sh/nvm#deeper-shell-integration), которая при нахождении файла
`.nvmrc` будет автоматически задействовать указанную в файле версию.

<alert>

Для пользователей Windows: при использовании https://github.com/coreybutler/nvm-windows следует помнить, что данный
проект не является аналогом [NVM](https://github.com/nvm-sh/nvm), что автор неоднократно подчеркивает. Файлы `.nvmrc`
данным инструментом не поддерживаются, однако есть ряд способов задействовать их:

- PowerShell:
  - https://github.com/coreybutler/nvm-windows/issues/16#issuecomment-365769478
  - https://github.com/coreybutler/nvm-windows/issues/388#issuecomment-454985039
- Command Prompt: https://github.com/coreybutler/nvm-windows/issues/16#issuecomment-391861370
- git bash: https://github.com/coreybutler/nvm-windows/issues/16#issuecomment-397290506

На основе этих идей были созданы также и более совершенные способы, например
https://gist.github.com/danpetitt/e87dabb707079e1bfaf797d0f5f798f2.

</alert>

Таким образом, можно дать следующие рекомендации:

- проверяйте ваши пакеты на совместимость и указывайте, по-крайней мере, минимальную версию Node.js в поле `engines`
  файла `package.json`;
- используйте файл `.nvmrc` для улучшения пользовательского опыта разработчиков.
- указывайте в `.nvmrc` точную версию Node.js без префикса `v` (возможно, это упростит работу для пользователей Windows,
  если таковые будут работать с вашим проектом)
